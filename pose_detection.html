<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pose Detection Game - AI for Good</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .home-button {
            position: fixed;
            top: 2rem;
            left: 2rem;
            background: white;
            color: #667eea;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .home-button:hover {
            transform: translateY(-3px);
        }
        
        #canvas {
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    display: block;
    margin: 0 auto;
}

    </style>
</head>
<body class="p-8">
    <a href="index.html" class="home-button">‚Üê Home</a>

    <div class="max-w-7xl mx-auto">
        <h1 class="text-5xl font-bold text-white text-center mb-4">ü§∏ Pose Detection Game</h1>
        <p class="text-xl text-white text-center mb-8 opacity-90">Match the poses as fast as you can!</p>

        <div id="loadingScreen" class="bg-white rounded-2xl p-12 text-center shadow-2xl">
            <div class="animate-pulse">
                <div class="text-6xl mb-4">üìπ</div>
                <h2 class="text-3xl font-bold text-purple-600 mb-4">Loading AI Camera...</h2>
                <p class="text-gray-600 text-lg">Please allow camera access when prompted</p>
            </div>
        </div>

        <div id="gameContainer" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="bg-white rounded-2xl p-6 shadow-2xl">
                    <h3 class="text-2xl font-bold text-purple-600 mb-4">üéØ Current Pose</h3>
                    <div id="currentPose" class="text-center">
                        <div class="text-6xl mb-2">üéÆ</div>
                        <div class="text-2xl font-bold">Ready?</div>
                        <div class="text-gray-600 mt-2">Click Start to begin!</div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-2xl">
                    <h3 class="text-2xl font-bold text-purple-600 mb-4">üìä Score</h3>
                    <div class="text-center">
                        <div id="score" class="text-6xl font-bold text-purple-600">0</div>
                        <div class="text-gray-600 mt-2">Poses Matched</div>
                    </div>
                </div>

                <div class="bg-white rounded-2xl p-6 shadow-2xl">
                    <h3 class="text-2xl font-bold text-purple-600 mb-4">‚è±Ô∏è Time</h3>
                    <div class="text-center">
                        <div id="timer" class="text-6xl font-bold text-purple-600">30</div>
                        <div class="text-gray-600 mt-2">Seconds Left</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-2xl mb-6">
                <canvas id="canvas"></canvas>
                <div class="flex gap-4 justify-center mt-4">
                    <button id="startBtn" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-4 rounded-xl text-xl font-bold hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all shadow-lg">
                        Start Game! üéÆ
                    </button>
                    <button id="resetBtn" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-8 py-4 rounded-xl text-xl font-bold hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition-all shadow-lg hidden">
                        Play Again üîÑ
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-6 shadow-xl">
                    <h3 class="text-xl font-bold text-purple-600 mb-2">üéØ What's Happening?</h3>
                    <p class="text-gray-600">The AI detects 17 points on your body in real-time and tracks your movements!</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-xl">
                    <h3 class="text-xl font-bold text-purple-600 mb-2">üß† How It Works</h3>
                    <p class="text-gray-600">Using machine learning, the AI learned from thousands of images to recognize human poses.</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-xl">
                    <h3 class="text-xl font-bold text-purple-600 mb-2">üåç Real-World Uses</h3>
                    <p class="text-gray-600">This technology helps in sports training, healthcare, and making games more interactive!</p>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-xl">
                    <h3 class="text-xl font-bold text-purple-600 mb-2">‚ú® AI For Good</h3>
                    <p class="text-gray-600">AI can help people exercise correctly, detect falls in elderly care, and more!</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const video = document.createElement('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const loadingScreen = document.getElementById('loadingScreen');
        const gameContainer = document.getElementById('gameContainer');

        let detector;
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let currentPoseIndex = 0;
        let timerInterval;

        const poses = [
            { name: 'T-Pose', emoji: 'üßç', description: 'Arms straight out to sides', check: checkTPose },
            { name: 'Hands Up', emoji: 'üôå', description: 'Both hands above head', check: checkHandsUp },
            { name: 'Right Hand Up', emoji: 'üëã', description: 'Raise your right hand high', check: checkRightHandUp },
            { name: 'Left Hand Up', emoji: '‚úã', description: 'Raise your left hand high', check: checkLeftHandUp },
            { name: 'Touch Toes', emoji: 'üôá', description: 'Bend down and touch your toes', check: checkTouchToes },
            { name: 'Star Jump', emoji: '‚≠ê', description: 'Arms and legs spread wide', check: checkStarJump }
        ];

        // Helper function to calculate angle between three points
        function calculateAngle(p1, p2, p3) {
            const radians = Math.atan2(p3.y - p2.y, p3.x - p2.x) - Math.atan2(p1.y - p2.y, p1.x - p2.x);
            let angle = Math.abs(radians * 180 / Math.PI);
            if (angle > 180) angle = 360 - angle;
            return angle;
        }

        function getKeypoint(keypoints, name) {
            const kp = keypoints.find(k => k.name === name);
            return (kp && kp.score > 0.3) ? kp : null;
        }

        function checkTPose(keypoints) {
            const leftShoulder = getKeypoint(keypoints, 'left_shoulder');
            const rightShoulder = getKeypoint(keypoints, 'right_shoulder');
            const leftElbow = getKeypoint(keypoints, 'left_elbow');
            const rightElbow = getKeypoint(keypoints, 'right_elbow');
            const leftWrist = getKeypoint(keypoints, 'left_wrist');
            const rightWrist = getKeypoint(keypoints, 'right_wrist');
            
            if (!leftShoulder || !rightShoulder || !leftElbow || !rightElbow || !leftWrist || !rightWrist) return false;
            
            // Calculate shoulder width for normalization
            const shoulderWidth = Math.abs(rightShoulder.x - leftShoulder.x);
            
            // Check if arms are extended horizontally (angle close to 180 degrees)
            const leftArmAngle = calculateAngle(leftWrist, leftElbow, leftShoulder);
            const rightArmAngle = calculateAngle(rightWrist, rightElbow, rightShoulder);
            
            // Check if elbows are roughly at shoulder height
            const leftElbowHeight = Math.abs(leftElbow.y - leftShoulder.y) / shoulderWidth;
            const rightElbowHeight = Math.abs(rightElbow.y - rightShoulder.y) / shoulderWidth;
            
            // Arms should be relatively straight and horizontal
            const armsExtended = leftArmAngle > 140 && rightArmAngle > 140;
            const armsHorizontal = leftElbowHeight < 0.5 && rightElbowHeight < 0.5;
            
            return armsExtended && armsHorizontal;
        }

        function checkStarJump(keypoints) {
            const leftWrist = getKeypoint(keypoints, 'left_wrist');
            const rightWrist = getKeypoint(keypoints, 'right_wrist');
            const leftAnkle = getKeypoint(keypoints, 'left_ankle');
            const rightAnkle = getKeypoint(keypoints, 'right_ankle');
            const leftShoulder = getKeypoint(keypoints, 'left_shoulder');
            const rightShoulder = getKeypoint(keypoints, 'right_shoulder');
            const leftHip = getKeypoint(keypoints, 'left_hip');
            const rightHip = getKeypoint(keypoints, 'right_hip');
            
            if (!leftWrist || !rightWrist || !leftAnkle || !rightAnkle || !leftShoulder || !rightShoulder || !leftHip || !rightHip) return false;
            
            const shoulderWidth = Math.abs(rightShoulder.x - leftShoulder.x);
            const hipWidth = Math.abs(rightHip.x - leftHip.x);
            
            // Check arms are wide and up
            const armSpan = Math.abs(rightWrist.x - leftWrist.x);
            const armsWide = armSpan / shoulderWidth > 2.5; // Arms wider than 2.5x shoulder width
            const armsUp = leftWrist.y < leftShoulder.y && rightWrist.y < rightShoulder.y;
            
            // Check legs are spread
            const legSpan = Math.abs(rightAnkle.x - leftAnkle.x);
            const legsWide = legSpan / hipWidth > 1.8; // Legs wider than 1.8x hip width
            
            return armsWide && armsUp && legsWide;
        }

        function checkHandsUp(keypoints) {
            const leftWrist = getKeypoint(keypoints, 'left_wrist');
            const rightWrist = getKeypoint(keypoints, 'right_wrist');
            const nose = getKeypoint(keypoints, 'nose');
            
            if (!leftWrist || !rightWrist || !nose) return false;
            
            return leftWrist.y < nose.y && rightWrist.y < nose.y;
        }

        function checkRightHandUp(keypoints) {
            const rightWrist = getKeypoint(keypoints, 'right_wrist');
            const rightShoulder = getKeypoint(keypoints, 'right_shoulder');
            const nose = getKeypoint(keypoints, 'nose');
            
            if (!rightWrist || !rightShoulder || !nose) return false;
            
            return rightWrist.y < nose.y && rightWrist.y < rightShoulder.y - 50;
        }

        function checkLeftHandUp(keypoints) {
            const leftWrist = getKeypoint(keypoints, 'left_wrist');
            const leftShoulder = getKeypoint(keypoints, 'left_shoulder');
            const nose = getKeypoint(keypoints, 'nose');
            
            if (!leftWrist || !leftShoulder || !nose) return false;
            
            return leftWrist.y < nose.y && leftWrist.y < leftShoulder.y - 50;
        }

        function checkTouchToes(keypoints) {
            const leftWrist = getKeypoint(keypoints, 'left_wrist');
            const rightWrist = getKeypoint(keypoints, 'right_wrist');
            const leftAnkle = getKeypoint(keypoints, 'left_ankle');
            const rightAnkle = getKeypoint(keypoints, 'right_ankle');
            const leftHip = getKeypoint(keypoints, 'left_hip');
            
            if (!leftWrist || !rightWrist || !leftAnkle || !rightAnkle || !leftHip) return false;
            
            const avgWristY = (leftWrist.y + rightWrist.y) / 2;
            const avgAnkleY = (leftAnkle.y + rightAnkle.y) / 2;
            
            return avgWristY > leftHip.y && Math.abs(avgWristY - avgAnkleY) < 150;
        }

        async function setupCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { width: 640, height: 480 }
            });
            video.srcObject = stream;
            
            return new Promise((resolve) => {
                video.onloadedmetadata = () => {
                    video.play();
                    resolve(video);
                };
            });
        }

        async function loadModel() {
            const model = poseDetection.SupportedModels.MoveNet;
            detector = await poseDetection.createDetector(model, {
                modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING
            });
        }

        async function detectPose() {
            if (!video.videoWidth) {
                requestAnimationFrame(detectPose);
                return;
            }

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const detectedPoses = await detector.estimatePoses(video);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.scale(-1, 1);
            ctx.translate(-canvas.width, 0);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            ctx.restore();

            if (detectedPoses.length > 0) {
                const pose = detectedPoses[0];
                drawSkeleton(pose.keypoints);
                
                if (gameActive && currentPoseIndex < poses.length) {
                    const currentPose = poses[currentPoseIndex];
                    if (currentPose.check(pose.keypoints)) {
                        score++;
                        document.getElementById('score').textContent = score;
                        currentPoseIndex++;
                        
                        if (currentPoseIndex < poses.length) {
                            updateCurrentPose();
                        } else {
                            endGame();
                        }
                    }
                }
            }

            requestAnimationFrame(detectPose);
        }

        function drawSkeleton(keypoints) {
            const connections = [
                ['left_shoulder', 'right_shoulder'],
                ['left_shoulder', 'left_elbow'],
                ['left_elbow', 'left_wrist'],
                ['right_shoulder', 'right_elbow'],
                ['right_elbow', 'right_wrist'],
                ['left_shoulder', 'left_hip'],
                ['right_shoulder', 'right_hip'],
                ['left_hip', 'right_hip'],
                ['left_hip', 'left_knee'],
                ['left_knee', 'left_ankle'],
                ['right_hip', 'right_knee'],
                ['right_knee', 'right_ankle']
            ];

            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 4;

            connections.forEach(([start, end]) => {
                const startPoint = keypoints.find(kp => kp.name === start);
                const endPoint = keypoints.find(kp => kp.name === end);
                
                if (startPoint && endPoint && startPoint.score > 0.3 && endPoint.score > 0.3) {
                    ctx.beginPath();
                    ctx.moveTo((1 - startPoint.x / canvas.width) * canvas.width, startPoint.y);
                    ctx.lineTo((1 - endPoint.x / canvas.width) * canvas.width, endPoint.y);
                    ctx.stroke();
                }
            });

            ctx.fillStyle = '#ff0000';
            keypoints.forEach(kp => {
                if (kp.score > 0.3) {
                    ctx.beginPath();
                    ctx.arc((1 - kp.x / canvas.width) * canvas.width, kp.y, 6, 0, 2 * Math.PI);
                    ctx.fill();
                }
            });
        }

        function updateCurrentPose() {
            const pose = poses[currentPoseIndex];
            document.getElementById('currentPose').innerHTML = `
                <div class="text-6xl mb-2">${pose.emoji}</div>
                <div class="text-2xl font-bold">${pose.name}</div>
                <div class="text-gray-600 mt-2">${pose.description}</div>
            `;
        }

        function startGame() {
            startBtn.classList.add('hidden');
            
            score = 0;
            timeLeft = 30;
            gameActive = true;
            currentPoseIndex = 0;
            
            document.getElementById('score').textContent = score;
            document.getElementById('timer').textContent = timeLeft;
            
            updateCurrentPose();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            
            document.getElementById('currentPose').innerHTML = `
                <div class="text-6xl mb-2">üéâ</div>
                <div class="text-2xl font-bold">Game Over!</div>
                <div class="text-gray-600 mt-2">Final Score: ${score}</div>
            `;
            
            resetBtn.classList.remove('hidden');
        }

        function resetGame() {
            resetBtn.classList.add('hidden');
            startBtn.classList.remove('hidden');
            
            document.getElementById('currentPose').innerHTML = `
                <div class="text-6xl mb-2">üéÆ</div>
                <div class="text-2xl font-bold">Ready?</div>
                <div class="text-gray-600 mt-2">Click Start to begin!</div>
            `;
        }

        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetGame);

        // Start initialization
        async function init() {
            try {
                await setupCamera();
                await loadModel();
                loadingScreen.classList.add('hidden');
                gameContainer.classList.remove('hidden');
                detectPose();
            } catch (error) {
                console.error('Error:', error);
                loadingScreen.innerHTML = `
                    <div class="text-red-600">
                        <div class="text-6xl mb-4">‚ùå</div>
                        <h2 class="text-3xl font-bold mb-4">Error Loading Camera</h2>
                        <p class="text-lg">${error.message}</p>
                    </div>
                `;
            }
        }

        init();
    </script>
</body>
</html>
